function t({initialState:t,context:e,onStateChange:n}){let i={value:t,context:e};return{getState:function(){return i},setState:function(t,e){i={value:null!=t?t:i.value,context:null!=e?e:i.context},n(i)}}}var e,n,i,a;!function(t){t.initializing="INITIALIZING",t.selectTask="SELECT_TASK",t.task="TASK",t.taskTimerEndPrompt="TASK_TIMER_END_PROMPT",t.shortBreak="SHORT_BREAK",t.longBreak="LONG_BREAK"}(e||(e={})),function(t){t.initializing="INITIALIZING",t.selectTask="SELECT_TASK",t.task="TASK",t.taskTimerEndPrompt="TASK_TIMER_END_PROMPT"}(n||(n={})),function(t){t.idle="IDLE",t.ready="READY",t.active="ACTIVE",t.paused="PAUSED"}(i||(i={})),function(t){t.task="TASK",t.shortBreak="SHORT_BREAK",t.longBreak="LONG_BREAK"}(a||(a={}));module.exports=({createTicker:n,settings:o})=>{const{emit:r,on:s,off:c}=(()=>{const t={};return{emit:(e,n)=>{var i;null===(i=t[e])||void 0===i||i.forEach((t=>t(n)))},off:(e,n)=>{const i=t[e];i&&(t[e]=i.filter((t=>t!==n)))},on:(e,n)=>{var i;const a=null!==(i=t[e])&&void 0!==i?i:[];a.push(n),t[e]=a}}})(),u=function({onStateChange:n}){const{getState:i,setState:a}=t({initialState:e.initializing,context:{currentTaskId:null},onStateChange:n});return{handleTimerEnd:function(){a(e.taskTimerEndPrompt)},selectTask:function(t){a(e.task,{currentTaskId:t})},transitionPomodoroState:function(t){a(t)},getState:i}}({onStateChange:l}),m=(({onStateChange:e,onTimerEnd:n,onTimerTick:a,ticker:o})=>{const{getState:r,setState:s}=t({initialState:i.idle,context:{timer:null},onStateChange:e});function c(){const{timer:t}=r().context;t&&(1===t.time?(s(i.idle,{timer:null}),o.stop(),n()):s(null,{timer:Object.assign(Object.assign({},t),{time:t.time-1})}))}return{createTimer:function({isInjected:t=!1,time:e,type:n}){s(i.ready,{timer:{isInjected:t,time:e,totalTime:e,type:n}})},pauseTimer:function(){s(i.paused),o.stop()},startTimer:function(){s(i.active),o.start((()=>{c(),a()}))},tickTimer:c,getState:r}})({onStateChange:l,onTimerEnd:function(){u.handleTimerEnd(),r("timerEnd",S())},onTimerTick:function(){r("timerTick",S())},ticker:n()});function l(){r("update",S())}function T(){const t=o.set[0];if("task"===t)return u.getState().context.currentTaskId?(m.getState().context.timer||m.createTimer({time:o.taskTime,type:a.task}),u.transitionPomodoroState(e.task)):u.transitionPomodoroState(e.selectTask);if("shortBreak"===t)return u.transitionPomodoroState(e.shortBreak);if("longBreak"===t)return u.transitionPomodoroState(e.longBreak);throw new Error(`Unknown set item: "${t}"`)}function S(){const t=u.getState(),e=m.getState(),n=e.context.timer?{isActive:e.value===i.active,isInjected:e.context.timer.isInjected,isPaused:e.value===i.paused,time:e.context.timer.time,totalTime:e.context.timer.totalTime,type:e.context.timer.type}:null;return{value:t.value,currentTaskId:t.context.currentTaskId,timer:n}}return{pauseTimer:function(){m.pauseTimer(),r("timerPause",S())},selectTask:function(t){u.selectTask(t),T(),r("taskSelect",S())},setReady:function(){T(),r("appInitialize",S())},startTimer:function(){const t=m.getState().value===i.paused;m.startTimer(),r(t?"timerResume":"timerStart",S())},getState:S,on:s,off:c}};
