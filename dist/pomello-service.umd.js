var t,e;t=this,e=function(){function t({initialState:t,context:e,onStateChange:n}){let i={value:t,context:e};return{getState:function(){return i},setState:function(t,e){i={value:null!=t?t:i.value,context:null!=e?e:i.context},n(i)}}}var e,n,i,o;!function(t){t.initializing="INITIALIZING",t.selectTask="SELECT_TASK",t.task="TASK",t.taskTimerEndPrompt="TASK_TIMER_END_PROMPT",t.shortBreak="SHORT_BREAK",t.longBreak="LONG_BREAK"}(e||(e={})),function(t){t.initializing="INITIALIZING",t.selectTask="SELECT_TASK",t.task="TASK",t.taskTimerEndPrompt="TASK_TIMER_END_PROMPT",t.shortBreak="SHORT_BREAK"}(n||(n={})),function(t){t.idle="IDLE",t.ready="READY",t.active="ACTIVE",t.paused="PAUSED"}(i||(i={})),function(t){t.task="TASK",t.shortBreak="SHORT_BREAK",t.longBreak="LONG_BREAK"}(o||(o={}));const a=({onStateChange:e,onTimerEnd:n,onTimerTick:o,ticker:a})=>{const{getState:r,setState:c}=t({initialState:i.idle,context:{timer:null},onStateChange:e});function s(){a.start((()=>{!function(){const{timer:t}=r().context;t&&(1===t.time?(c(i.idle,{timer:null}),a.stop(),n()):c(null,{timer:Object.assign(Object.assign({},t),{time:t.time-1})}))}(),o()}))}return{createTimer:function({isInjected:t=!1,time:e,type:n}){c(i.ready,{timer:{isInjected:t,time:e,totalTime:e,type:n}})},pauseTimer:function(){c(i.paused),a.stop()},startTimer:function(){c(i.active),s()},getState:r}};return({createTicker:n,settings:r})=>{const{batchedEmit:c,emit:s,on:u,off:m}=(()=>{const t={},e=new Map;function n(e,n){var i;null===(i=t[e])||void 0===i||i.forEach((t=>t(n)))}return{batchedEmit:function(t,i){e.size>0?e.set(t,i):(e.set(t,i),setImmediate((function(){for(const[t,i]of e)n(t,i);e.clear()})))},emit:n,off:function(e,n){const i=t[e];i&&(t[e]=i.filter((t=>t!==n)))},on:function(e,n){var i;const o=null!==(i=t[e])&&void 0!==i?i:[];o.push(n),t[e]=o}}})(),l=function({onStateChange:n}){const{getState:i,setState:o}=t({initialState:e.initializing,context:{currentTaskId:null},onStateChange:n});return{handleTimerEnd:function(){o(e.taskTimerEndPrompt)},selectTask:function(t){o(e.task,{currentTaskId:t})},transitionPomodoroState:function(t){o(t)},getState:i}}({onStateChange:d}),T=a({onStateChange:d,onTimerEnd:function(){l.handleTimerEnd(),f+=1,f>r.set.length&&(f=0),s("timerEnd",g())},onTimerTick:function(){s("timerTick",g())},ticker:n()});let f=0;function d(){c("update",g())}function S(){const t=r.set[f];if("task"===t)return l.getState().context.currentTaskId?(T.getState().context.timer||T.createTimer({time:r.taskTime,type:o.task}),l.transitionPomodoroState(e.task)):l.transitionPomodoroState(e.selectTask);if("shortBreak"===t)return T.createTimer({time:r.shortBreakTime,type:o.shortBreak}),l.transitionPomodoroState(e.shortBreak),k();if("longBreak"===t)return l.transitionPomodoroState(e.longBreak);throw new Error(`Unknown set item: "${t}"`)}function k(){const t=T.getState().value===i.paused;T.startTimer(),s(t?"timerResume":"timerStart",g())}function g(){const t=l.getState(),e=T.getState(),n=e.context.timer?{isActive:e.value===i.active,isInjected:e.context.timer.isInjected,isPaused:e.value===i.paused,time:e.context.timer.time,totalTime:e.context.timer.totalTime,type:e.context.timer.type}:null;return{value:t.value,currentTaskId:t.context.currentTaskId,timer:n}}return{continueTask:function(){S()},pauseTimer:function(){T.pauseTimer(),s("timerPause",g())},selectTask:function(t){l.selectTask(t),S(),s("taskSelect",g())},setReady:function(){S(),s("appInitialize",g())},startTimer:k,getState:g,on:u,off:m}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).createPomelloService=e();
